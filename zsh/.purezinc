#!/usr/bin/env zsh

## ZINC CONFIGURATION
typeset -gA zinc_opts

# Segment functions:
function zc_begin () {
  REPLY="%{" # invis chars
  REPLY+=$'\033[1A' # up 1L
  REPLY+="%}"
}

function zc_end () {
  REPLY=""
  REPLY+="${_ZINC_SEP_CHARS[rprompt_terminating_space]}"
  REPLY+="%{" # invis chars
  REPLY+=$'\033[1B' # down 1L
  REPLY+="%}"
}

function zincs_newline () {
  REPLY=$'\n'
}

zincs_retval_fg () {
	[[ $_ZINC_RETVAL_STORE == '0' ]] && REPLY='green' || REPLY='red'
}

zinc_left=(
  zincs_cwd_writable
  zincs_cwd
  zincs_vcs
  zincs_execution_time
  zincs_newline
)

zinc_right=(
  zc_begin
  zincs_retval
  zc_end
)

# make a blank line that we can safely draw the RPROMPT into
function _zc_newline () {
  echo ""
}

source ~/.cache/antibody/https-COLON--SLASH--SLASH-github.com-SLASH-robobenklein-SLASH-zinc/zinc_functions/-zinc-add-hook
-zinc-add-hook _zinc_precmd _zc_newline

zinc_opts=(
	zincs_cwd			 "blue;none;;;rtab;-t;-l"
	zincs_cwd_writable	 "red;none;CONDITIONAL;normal;"
	zincs_vcs			 ";none;;;"
	zincs_execution_time "yellow;none;;;"
	zincs_retval		 "CONDITIONAL;normal;CONDITIONAL;CONDITIONL"
	zincs_newline		 "none;none;ZINC_SEGMENT_NONRENDERABLE;none"
	zc_begin			 "none;none;ZINC_SEGMENT_NONRENDERABLE;none"
	zc_end				 "none;none;ZINC_SEGMENT_NONRENDERABLE;none"
)

typeset -gA _ZINC_SEP_CHARS
typeset -g _ZINC_SEP_CHARS[left]="%F{magenta}❯%f"
typeset -g _ZINC_SEP_CHARS[right]=""
typeset -g _ZINC_SEP_CHARS[left_bgmatch]=""
typeset -g _ZINC_SEP_CHARS[right_bgmatch]=""

typeset -gA zincs_vcs
typeset -g zincs_vcs[vcs_icon_status_staged]=$'\u271a'
typeset -g zincs_vcs[loading_msg]='...'

typeset -gA zincs_cwd_writable
typeset -g zincs_cwd_writable[symbol]="❌"

typeset -gA zincs_execution_time
typeset -g zincs_execution_time[time_icon]=' ms'
